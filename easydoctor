#!/usr/bin/env php
<?php

error_reporting(E_ERROR);

// composer autoloader
require_once __DIR__ . '/vendor/autoload.php';

// bash formatting vars
$boldS = "\033[1m";
$boldE = "\033[0m";
$redS = "\033[31m";
$redE = "\033[0m";

// combine arguments in config array
$argsConfig = [
    'project'   =>  $_SERVER['argv'][1]
];

// checks
if(empty($argsConfig['project'])){
    echo 'error: please define a project. Syntax: php easydoctor projectname';
    exit;
}

// Require composer autoloader and load libraries
use SaschaEnde\Easydoctor\Easydoctor;
use SaschaEnde\Easydoctor\Exporter;

// call the doctor
$doctor = new Easydoctor();
$exporter = new Exporter($argsConfig);

// scan documentation dir
$docFiles = $doctor->scandir('doc/'.$argsConfig['project']);

// load the pages now
foreach($docFiles as $filename){
    $fileContents = file_get_contents('doc/'.$argsConfig['project'].'/'.$filename);
    $doctor->addToContentList($fileContents);
    $exporter->addPage($fileContents);
}

// Generate the contents list
$exporter->setContents($doctor->renderContentList());

// Finally render
$exporter->render();


echo "You called the doctor, the documentation was rendered to ${redS}".$pdfPath.$redE;