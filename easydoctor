#!/usr/bin/env php
<?php

error_reporting(E_ERROR);

// composer autoloader
require_once __DIR__ . '/vendor/autoload.php';

// Require composer autoloader and load libraries
use SaschaEnde\Easydoctor\Easydoctor;
use SaschaEnde\Easydoctor\Exporter;

// call the doctor
$doctor = new Easydoctor();
$doctor->printOutput("you called the doctor, welcome...");


$argsConfig = $doctor->getArguments();

// call exporter
$exporter = new Exporter($argsConfig);

// checks
if(empty($argsConfig['p'])){
    echo 'error: please define a project. Syntax: php easydoctor projectname';
    exit;
}

// scan documentation dir
$docFiles = $doctor->scandir('doc/'.$argsConfig['p']);

// load the pages now
foreach($docFiles as $filename){
    $fileContents = file_get_contents('doc/'.$argsConfig['p'].'/'.$filename);
    $doctor->addToContentList($fileContents);
    $fileContents = $doctor->renderPhpCode($fileContents);
    $exporter->addPage($fileContents);
}

// Generate the contents list
$exporter->setContents($doctor->renderContentList());

// Finally render
$exporter->render();

// success
$doctor->printOutput("thanks, the documentation was rendered");